<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hospital Management System - Patients</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap");
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        background: #f5f8fa;
        color: #333;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      nav {
        background: #374785;
        padding: 1rem 2rem;
        display: flex;
        align-items: center;
      }
      nav a {
        color: #f0f0f0;
        text-decoration: none;
        margin-right: 1.8rem;
        font-weight: 600;
        font-size: 1.1rem;
      }
      nav a:hover {
        color: #f9aa33;
      }
      nav a.active {
        color: #f9aa33;
        font-weight: 700;
        border-bottom: 2px solid #f9aa33;
      }
      header {
        background: #24305e;
        color: white;
        padding: 1.5rem 2rem;
        font-size: 1.6rem;
        font-weight: 600;
      }
      main {
        flex-grow: 1;
        max-width: 900px;
        margin: 2rem auto;
        padding: 0 1rem;
      }
      h2 {
        color: #374785;
        text-align: center;
        margin-bottom: 1.5rem;
      }
      form {
        max-width: 600px;
        margin: 0 auto 2rem;
        background: white;
        padding: 1.5rem 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      label {
        display: block;
        margin-bottom: 1rem;
        font-weight: 600;
        color: #555;
      }
      input[type="text"],
      input[type="email"],
      input[type="date"] {
        width: 100%;
        padding: 0.5rem 0.7rem;
        border: 1.5px solid #ccc;
        border-radius: 8px;
        font-size: 1rem;
        margin-top: 0.3rem;
        transition: border-color 0.3s ease;
      }
      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="date"]:focus {
        outline: none;
        border-color: #374785;
        box-shadow: 0 0 5px #a0a9db;
      }
      button {
        display: block;
        width: 100%;
        padding: 0.8rem;
        background: #374785;
        border: none;
        color: white;
        font-weight: 700;
        font-size: 1.1rem;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      button:hover {
        background: #2a3460;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      thead {
        background: #374785;
        color: white;
      }
      th,
      td {
        padding: 0.9rem 1rem;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      tbody tr:hover {
        background: #f0f4ff;
        cursor: pointer;
      }
      .delete-btn {
        background: #e74c3c;
        border: none;
        color: white;
        padding: 0.3rem 0.7rem;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      .delete-btn:hover {
        background: #b73729;
      }
      @media (max-width: 600px) {
        table,
        thead,
        tbody,
        th,
        td,
        tr {
          display: block;
        }
        thead tr {
          position: absolute;
          top: -9999px;
          left: -9999px;
        }
        tr {
          border: 1px solid #ccc;
          margin-bottom: 0.75rem;
          border-radius: 10px;
          padding: 0.5rem;
        }
        td {
          border: none;
          position: relative;
          padding-left: 50%;
          white-space: pre-wrap;
          word-wrap: break-word;
        }
        td::before {
          position: absolute;
          top: 0.5rem;
          left: 1rem;
          width: 45%;
          white-space: nowrap;
          font-weight: 700;
          color: #374785;
        }
        td:nth-of-type(1)::before {
          content: "Name";
        }
        td:nth-of-type(2)::before {
          content: "Email";
        }
        td:nth-of-type(3)::before {
          content: "Date of Birth";
        }
        td:nth-of-type(4)::before {
          content: "";
        } /* For the Actions column */
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="appointments.html">Appointments</a>
      <a href="patients.html" class="active">Patients</a>
      <a href="doctors.html">Doctors</a>
    </nav>
    <header>Manage Patients</header>
    <main>
      <h2>Add New Patient</h2>
      <form id="patientForm" novalidate autocomplete="off">
        <label for="patientName"
          >Name:
          <input
            type="text"
            id="patientName"
            required
            placeholder="Full name"
          />
        </label>
        <label for="patientEmail"
          >Email:
          <input
            type="email"
            id="patientEmail"
            required
            placeholder="example@example.com"
          />
        </label>
        <label for="patientDOB"
          >Date of Birth:
          <input type="date" id="patientDOB" required max="" />
        </label>
        <button type="submit">Add Patient</button>
      </form>
      <h2>Patient List</h2>
      <table aria-label="Patient List">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Date of Birth</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="patientsTableBody"></tbody>
      </table>
    </main>
    <script>
      // ... (keep existing CSS and HTML structure)

      // In patients.html
      const patientForm = document.getElementById("patientForm");
      const patientsTableBody = document.getElementById("patientsTableBody");

      async function loadPatients() {
        try {
          const response = await fetch("http://localhost:3000/patients");
          const patients = await response.json();

          patientsTableBody.innerHTML = "";
          if (patients.length === 0) {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td colspan="4" style="text-align:center; color:#888;">No patients found.</td>`;
            patientsTableBody.appendChild(tr);
            return;
          }
          patients.forEach((patient) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${patient.name}</td>
                <td>${patient.email}</td>
                <td>${patient.dob}</td>
                <td><button class="delete-btn" data-id="${patient.id}" aria-label="Delete patient">Delete</button></td>
            `;
            patientsTableBody.appendChild(tr);
          });
        } catch (error) {
          console.error("Error loading patients:", error);
          alert("Failed to load patients.");
        }
      }

      patientForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("patientName").value.trim();
        const email = document.getElementById("patientEmail").value.trim();
        const dob = document.getElementById("patientDOB").value;

        if (!name) {
          alert("Please enter the patient's name.");
          return;
        }
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          // Basic email validation
          alert("Please enter a valid email address.");
          return;
        }
        if (!dob) {
          alert("Please enter the date of birth.");
          return;
        }

        try {
          const response = await fetch("http://localhost:3000/patients", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name, email, dob }),
          });

          if (response.ok) {
            const newPatient = await response.json();
            patientForm.reset();
            loadPatients();
            alert("Patient added successfully!");
          } else {
            const errorData = await response.json();
            alert(
              "Failed to add patient: " + (errorData.error || "Unknown error")
            );
          }
        } catch (error) {
          console.error("Error adding patient:", error);
          alert("An error occurred while adding the patient.");
        }
      });

      patientsTableBody.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-btn")) {
          const patientId = e.target.dataset.id;
          if (confirm("Are you sure you want to delete this patient?")) {
            try {
              const response = await fetch(
                `http://localhost:3000/patients/${patientId}`,
                {
                  method: "DELETE",
                }
              );

              if (response.ok) {
                loadPatients();
              } else {
                const errorData = await response.json();
                alert(
                  "Failed to delete patient: " +
                    (errorData.error || "Unknown error")
                );
              }
            } catch (error) {
              console.error("Error deleting patient:", error);
              alert("An error occurred while deleting the patient.");
            }
          }
        }
      });

      window.addEventListener("DOMContentLoaded", loadPatients);
    </script>
  </body>
</html>
